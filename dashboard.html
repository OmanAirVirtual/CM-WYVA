<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="styles.css">
    <title>Dashboard | Crew Centre</title>
</head>
<body>
    <script type="module" src="navbar.js"></script>
    <main class="container">
        <section class="career-section">
            <h2 style="color: white; margin-top: 0;">Welcome to Oman Air Virtual</h2>
            <p>Welcome to the most advanced career mode. Fly, earn, and upgrade your fleet. Our career system is designed to simulate the life of a commercial pilot, requiring precision, dedication, and professional flight reporting.</p>
        </section>

        <div class="stats-row">
            <div class="stats-box box-blue">
                <small>Total Pilots</small>
                <h2 id="totalPilots">0</h2>
            </div>
            <div class="stats-box box-purple">
                <small>Monthly Distance</small>
                <h2 id="totalDist">0 nm</h2>
            </div>
            <div class="stats-box box-pink">
                <small>Total PIREPs</small>
                <h2 id="totalPireps">0</h2>
            </div>
        </div>
    </main>
    <script type="module">
        import { supabase } from './supabase.js';
        async function loadGlobalStats() {
            const { count: pilots } = await supabase.from('profiles').select('*', { count: 'exact', head: true });
            const { data: pireps } = await supabase.from('pireps').select('distance_flown').eq('status', 'Approved');
            const dist = pireps?.reduce((a, b) => a + (b.distance_flown || 0), 0) || 0;
            document.getElementById('totalPilots').innerText = pilots || 0;
            document.getElementById('totalDist').innerText = dist.toLocaleString() + " nm";
            document.getElementById('totalPireps').innerText = pireps?.length || 0;
        }
        loadGlobalStats();
    </script>
</body>
</html>
